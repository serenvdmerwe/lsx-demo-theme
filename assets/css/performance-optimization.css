/*
 * Performance Optimization Styles
 * Critical rendering path optimizations for luxury boot catalog
 * Focus on Core Web Vitals: LCP, FID, CLS improvements
 */

/* ==========================================================================
   Critical Path Optimizations
   ========================================================================== */

/* Above-the-fold critical styles */
.hero-section,
.product-filter-bar,
.main-navigation {
    /* Prevent layout shift during load */
    min-height: 60px;
    contain: layout style paint;
}

/* Layout containment for product grids */
.product-grid-container {
    contain: layout style paint;
    transform: translateZ(0); /* Hardware acceleration */
}

/* Optimize font loading */
@font-face {
    font-family: 'Playfair Display';
    font-display: swap; /* Improve FCP */
    font-weight: 400 700;
}

@font-face {
    font-family: 'Montserrat';
    font-display: swap;
    font-weight: 300 600;
}

@font-face {
    font-family: 'Open Sans';
    font-display: swap;
    font-weight: 400 600;
}

/* ==========================================================================
   Largest Contentful Paint (LCP) Optimizations
   ========================================================================== */

/* Hero image optimization */
.hero-image,
.featured-product-image {
    /* Prioritize critical images */
    content-visibility: auto;
    contain-intrinsic-size: 800px 600px;

    /* Optimize loading */
    loading: eager; /* For above-fold images */
    decoding: async;

    /* Prevent layout shift */
    width: 100%;
    height: auto;
    aspect-ratio: 4/3;
}

/* Product card images */
.product-card-image {
    /* Lazy load below-fold images */
    loading: lazy;
    decoding: async;

    /* Prevent layout shift */
    aspect-ratio: 1/1;
    object-fit: cover;
    width: 100%;

    /* Optimize rendering */
    contain: layout style paint;
    content-visibility: auto;
    contain-intrinsic-size: 300px 300px;
}

/* ==========================================================================
   First Input Delay (FID) Optimizations
   ========================================================================== */

/* Optimize interactive elements */
.wp-block-button__link,
.filter-button,
.product-quick-view,
.navigation-link {
    /* Improve interaction readiness */
    cursor: pointer;
    touch-action: manipulation;

    /* Hardware acceleration */
    transform: translateZ(0);
    will-change: transform, opacity;

    /* Prevent accidental zooms */
    user-select: none;
}

/* Filter system optimization */
.product-filter-container {
    /* Isolate expensive operations */
    contain: layout style paint;
    isolation: isolate;
}

.filter-dropdown {
    /* Optimize dropdown performance */
    contain: layout style;
    transform: translateZ(0);
}

.filter-dropdown.is-open {
    /* Only animate when needed */
    will-change: opacity, transform;
}

.filter-dropdown:not(.is-open) {
    will-change: auto;
}

/* ==========================================================================
   Cumulative Layout Shift (CLS) Prevention
   ========================================================================== */

/* Reserve space for dynamic content */
.product-loading-skeleton {
    background: linear-gradient(
        90deg,
        var(--wp--preset--color--luxury-neutral-100) 0%,
        var(--wp--preset--color--luxury-neutral-200) 50%,
        var(--wp--preset--color--luxury-neutral-100) 100%
    );
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite linear;
    border-radius: 6px;
}

@keyframes shimmer {
    0% {
        background-position: -200% 0;
    }
    100% {
        background-position: 200% 0;
    }
}

/* Fixed dimensions for layout stability */
.product-card {
    /* Prevent layout shift */
    min-height: 400px;
    max-height: 500px;

    /* Contain layout changes */
    contain: layout style paint;
}

.product-card-content {
    /* Reserve space for text content */
    min-height: 120px;
    padding: var(--wp--preset--spacing--25);
}

/* Navigation stability */
.main-navigation {
    /* Fixed height prevents shifts */
    height: 80px;
    contain: layout style;
}

.mobile-menu {
    /* Prevent shifts during menu toggle */
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    transform: translateY(-100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.mobile-menu.is-open {
    transform: translateY(0);
}

/* ==========================================================================
   GPU Acceleration & Compositing
   ========================================================================== */

/* Create compositing layers for expensive elements */
.product-hover-overlay,
.filter-animation-container,
.modal-backdrop {
    /* Promote to GPU layer */
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
}

/* Optimize transforms */
.product-card-hover-effect {
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.product-card:hover .product-card-hover-effect {
    transform: scale(1.02) translateZ(0);
}

/* ==========================================================================
   Memory & Resource Management
   ========================================================================== */

/* Efficient image handling */
.product-gallery {
    /* Virtualize off-screen content */
    content-visibility: auto;
    contain-intrinsic-size: 300px 400px;
}

/* Limit concurrent animations */
@media (prefers-reduced-motion: no-preference) {
    .product-card:nth-child(n + 10) {
        /* Defer animations for cards below fold */
        animation-delay: calc(var(--card-index, 0) * 0.1s);
    }
}

/* ==========================================================================
   Critical CSS Inlining Strategy
   ========================================================================== */

/* Above-the-fold critical styles (inline these) */
.critical-hero {
    display: block;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    background: var(--wp--preset--color--primary-black);
    color: var(--wp--preset--color--ivory);
    padding: var(--wp--preset--spacing--60) var(--wp--preset--spacing--40);
    text-align: center;
}

.critical-hero h1 {
    font-family: var(--wp--preset--font-family--playfair-display);
    font-size: clamp(32px, 6vw, 48px);
    font-weight: 600;
    line-height: 1.2;
    margin-bottom: var(--wp--preset--spacing--30);
    color: var(--wp--preset--color--ivory);
}

.critical-cta {
    background: var(--wp--preset--color--luxury-gold);
    color: var(--wp--preset--color--primary-black);
    padding: var(--wp--preset--spacing--20) var(--wp--preset--spacing--40);
    border: none;
    border-radius: 4px;
    font-family: var(--wp--preset--font-family--montserrat);
    font-size: 16px;
    font-weight: 600;
    text-decoration: none;
    display: inline-block;
    cursor: pointer;
    transition: transform 0.2s ease;
}

/* ==========================================================================
   Lazy Loading & Progressive Enhancement
   ========================================================================== */

/* Progressive image enhancement */
.progressive-image {
    background: var(--wp--preset--color--luxury-neutral-100);
    transition: opacity 0.3s ease;
}

.progressive-image[data-loaded='true'] {
    opacity: 1;
}

.progressive-image[data-loaded='false'] {
    opacity: 0.7;
}

/* Intersection Observer optimizations */
.lazy-load-container {
    /* Optimize for intersection calculations */
    contain: layout style paint;
    transform: translateZ(0);
}

/* ==========================================================================
   Network & Bundle Optimizations
   ========================================================================== */

/* Preload critical resources */
.preload-fonts {
    /* These should be in HTML head */
    /*
	<link rel="preload" href="/fonts/playfair-display.woff2" as="font" type="font/woff2" crossorigin>
	<link rel="preload" href="/fonts/montserrat.woff2" as="font" type="font/woff2" crossorigin>
	*/
}

/* Resource hints for performance */
.dns-prefetch-hints {
    /* These should be in HTML head */
    /*
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	*/
}

/* ==========================================================================
   Mobile Performance Optimizations
   ========================================================================== */

@media (max-width: 768px) {
    /* Reduce complexity on mobile */
    .desktop-only-animations {
        animation: none !important;
        transition: none !important;
        transform: none !important;
    }

    /* Optimize touch interactions */
    .mobile-touch-optimize {
        -webkit-tap-highlight-color: rgba(212, 175, 55, 0.3);
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
    }

    /* Reduce repaints on mobile */
    .product-grid {
        /* Simpler layout on mobile */
        display: block;
    }

    .product-card {
        /* Reduce GPU memory usage */
        transform: none;
        will-change: auto;
    }
}

/* ==========================================================================
   Performance Monitoring Utilities
   ========================================================================== */

/* Performance markers for measurement */
.perf-marker {
    /* Hidden markers for performance measurement */
    position: absolute;
    left: -9999px;
    opacity: 0;
    pointer-events: none;
}

/* Web Vitals optimization classes */
.lcp-optimized {
    /* Mark LCP candidates */
    contain: layout style paint;
    content-visibility: auto;
}

.fid-optimized {
    /* Mark interactive elements */
    touch-action: manipulation;
    cursor: pointer;
}

.cls-stable {
    /* Mark layout-stable elements */
    contain: layout;
    min-height: 1px; /* Prevent collapse */
}

/* ==========================================================================
   Browser-Specific Optimizations
   ========================================================================== */

/* Safari optimizations */
@supports (-webkit-appearance: none) {
    .safari-optimize {
        -webkit-backface-visibility: hidden;
        -webkit-perspective: 1000px;
        -webkit-transform: translateZ(0);
    }
}

/* Chrome optimizations */
@supports (contain: paint) {
    .chrome-optimize {
        contain: layout style paint;
        content-visibility: auto;
    }
}

/* Firefox optimizations */
@-moz-document url-prefix() {
    .firefox-optimize {
        /* Firefox-specific optimizations */
        transform: translateZ(0);
    }
}

/* ==========================================================================
   Development Performance Testing
   ========================================================================== */

/* Performance testing utilities (remove in production) */
.perf-test-heavy {
    /* Simulate expensive operations for testing */
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.1), 0 8px 16px rgba(0, 0, 0, 0.1),
        0 16px 32px rgba(0, 0, 0, 0.1);
    border-radius: 50px;
    background: linear-gradient(
        45deg,
        var(--wp--preset--color--luxury-gold),
        var(--wp--preset--color--luxury-burgundy),
        var(--wp--preset--color--primary-black)
    );
    background-size: 300% 300%;
    animation: gradient-shift 3s ease infinite;
}

@keyframes gradient-shift {
    0% {
        background-position: 0% 50%;
    }
    50% {
        background-position: 100% 50%;
    }
    100% {
        background-position: 0% 50%;
    }
}

/* Disable heavy effects on slower devices */
@media (prefers-reduced-motion: reduce) {
    .perf-test-heavy {
        animation: none;
        background: var(--wp--preset--color--luxury-gold);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
}
